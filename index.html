<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fruit Game</title>
    <link rel="icon" href="apple.png">
    <link rel="apple-touch-icon" href="apple.png">
    <link rel="apple-touch-icon-precomposed" href="apple.png">
    <meta name="description" content="フルーツをタップしよう！子供向けゲーム">
    <meta name="keywords" content="game, ゲーム, フルーツゲーム、知育、子供向けゲーム">
    <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #ffbcbc;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.min.js"></script>
    <script>
        const config = {
            type: Phaser.AUTO,
            width: window.innerWidth,
            height: window.innerHeight,
            backgroundColor: '#ffbcbc',
            scene: {
                preload: preload,
                create: create,
                update: update
            },
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 0 },
                    debug: false
                }
            }
        };

        const game = new Phaser.Game(config);

        let fruits;
        let currentFruit = 'apple';
        const fruitTypes = ['apple', 'grape', 'banana', 'melon', 'orange'];

        function preload() {
            this.load.image('apple', 'apple.png');
            this.load.image('grape', 'grape.png');
            this.load.image('banana', 'banana.png');
            this.load.image('melon', 'melon.png');
            this.load.image('orange', 'orange.png');
            this.load.audio('pop', 'pecho.mp3');
            this.load.audio('appear', 'puho.mp3');
        }

        function create() {
            fruits = this.physics.add.group();
            this.input.on('pointerdown', handleTap, this);

            this.popSound = this.sound.add('pop');
            this.appearSound = this.sound.add('appear');

            generateFruits.call(this, currentFruit);
        }

        function update() {
            // ここでは何もしない
        }

        function handleTap(pointer) {
            const children = fruits.getChildren();
            for (let i = children.length - 1; i >= 0; i--) {
                const fruit = children[i];
                if (Phaser.Geom.Rectangle.Contains(fruit.getBounds(), pointer.x, pointer.y)) {
                    fruit.destroy();
                    this.popSound.play();
                    break;
                }
            }

            if (fruits.countActive(true) === 0) {
                const nextIndex = (fruitTypes.indexOf(currentFruit) + 1) % fruitTypes.length;
                currentFruit = fruitTypes[nextIndex];
                generateFruits.call(this, currentFruit);
            }
        }

        function generateFruits(type) {
            fruits.clear(true, true);

            // 果物の速度
            const fruitSpeedX = 0.2; // X軸方向の速度
            const fruitSpeedY = 0.2; // Y軸方向の速度

            for (let i = 0; i < 5; i++) {
                let x = Phaser.Math.Between(100, game.config.width - 100);
                let y = Phaser.Math.Between(100, game.config.height - 100);

                // 画面端の100px以内に生成されないように制限
                if (x < 100) {
                    x += 100;
                } else if (x > game.config.width - 100) {
                    x -= 100;
                }
                if (y < 100) {
                    y += 100;
                } else if (y > game.config.height - 100) {
                    y -= 100;
                }

                const fruit = fruits.create(x, y, type).setInteractive();

                // 果物のサイズを画面の面積の10分の1に設定
                const screenArea = game.config.width * game.config.height;
                const fruitArea = screenArea / 8;
                const fruitWidth = Math.sqrt(fruitArea);
                const fruitHeight = fruitWidth;
                
                fruit.setScale(fruitWidth / fruit.width, fruitHeight / fruit.height);

                // 果物のアニメーションを設定
                this.tweens.add({
                    targets: fruit,
                    duration: Phaser.Math.Between(4000, 6000), // アニメーションの期間
                    x: x + Phaser.Math.Between(-100, 100), // X方向の揺れ
                    y: y + Phaser.Math.Between(-100, 100), // Y方向の揺れ
                    yoyo: true, // アニメーションを繰り返す
                    repeat: -1, // 無限に繰り返す
                    ease: 'Sine.easeInOut', // ゆらゆらとした動き
                });

                // 果物の速度を設定
                fruit.speedX = fruitSpeedX;
                fruit.speedY = fruitSpeedY;
            }

            this.appearSound.play();
        }

        window.onresize = function() {
            game.scale.resize(window.innerWidth, window.innerHeight);
        };
    </script>
</body>
</html>
